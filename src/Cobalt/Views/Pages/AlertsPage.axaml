<reactiveUi:ReactiveUserControl x:TypeArguments="pages:AlertsPageViewModel" xmlns="https://github.com/avaloniaui"
                                xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
                                xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
                                xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
                                xmlns:reactiveUi="http://reactiveui.net"
                                xmlns:pages="clr-namespace:Cobalt.Common.ViewModels.Pages;assembly=Cobalt.Common.ViewModels"
                                xmlns:controls="clr-namespace:FluentAvalonia.UI.Controls;assembly=FluentAvalonia"
                                xmlns:entities="clr-namespace:Cobalt.Common.ViewModels.Entities;assembly=Cobalt.Common.ViewModels"
                                xmlns:data="clr-namespace:Cobalt.Common.Data;assembly=Cobalt.Common.Data"
                                xmlns:dataEntities="clr-namespace:Cobalt.Common.Data.Entities;assembly=Cobalt.Common.Data"
                                xmlns:system="clr-namespace:System;assembly=System.Runtime"
                                mc:Ignorable="d" d:DesignWidth="800" d:DesignHeight="450" Padding="16"
                                x:Class="Cobalt.Views.Pages.AlertsPage" x:DataType="pages:AlertsPageViewModel">
    <ScrollViewer>
        <ScrollViewer.DataTemplates>

            <DataTemplate DataType="entities:TagViewModel">
                <StackPanel Orientation="Horizontal" Margin="8,0,8,0">
                    <controls:SymbolIcon Symbol="Tag" FontSize="32" VerticalAlignment="Center" Margin="8,0,16,0"
                                         Foreground="{Binding Color, Converter={StaticResource ColorStringToBrushConverter}}" />

                    <StackPanel Orientation="Vertical" VerticalAlignment="Center">
                        <TextBlock Text="{Binding Name}" VerticalAlignment="Center"
                                   Theme="{StaticResource SubtitleTextBlockStyle}" />
                        <StackPanel Orientation="Horizontal" Margin="0,4,0,0">

                            <ItemsRepeater ItemsSource="{Binding AppsSubset}">
                                <ItemsRepeater.Layout>
                                    <StackLayout Spacing="8" Orientation="Horizontal" />
                                </ItemsRepeater.Layout>
                                <ItemsRepeater.ItemTemplate>
                                    <DataTemplate DataType="entities:AppViewModel">
                                        <controls:FABorder CornerRadius="4" Padding="4,2"
                                                           Background="{DynamicResource ControlFillColorSecondaryBrush}">

                                            <StackPanel Orientation="Horizontal">

                                                <Image Width="16" Height="16" Margin="0,0,4,0"
                                                       VerticalAlignment="Center"
                                                       Source="{Binding Image.Value^, Converter={StaticResource BytesToImageConverter}}" />

                                                <TextBlock Text="{Binding Name}" VerticalAlignment="Center"
                                                           Theme="{StaticResource CaptionTextBlockStyle}" />

                                            </StackPanel>
                                        </controls:FABorder>
                                    </DataTemplate>
                                </ItemsRepeater.ItemTemplate>
                            </ItemsRepeater>

                            <controls:FABorder Margin="8,0,0,0" Padding="4,2"
                                               Background="{DynamicResource ControlFillColorSecondaryBrush}"
                                               CornerRadius="4" IsVisible="{Binding !!AppsNotInSubset}">
                                <TextBlock Text="{Binding AppsNotInSubset, StringFormat={}+{0}}" />
                            </controls:FABorder>

                        </StackPanel>
                    </StackPanel>
                </StackPanel>
            </DataTemplate>

            <DataTemplate DataType="entities:AppViewModel">
                <StackPanel Orientation="Horizontal" Margin="8,0,8,0">
                    <Image Width="32" Height="32" Margin="8,0,16,0" VerticalAlignment="Center"
                           Source="{Binding Image.Value^, Converter={StaticResource BytesToImageConverter}}" />

                    <StackPanel Orientation="Vertical" VerticalAlignment="Center">
                        <TextBlock Text="{Binding Name}"
                                   Theme="{StaticResource SubtitleTextBlockStyle}" />
                        <TextBlock Text="{Binding Description}"
                                   Theme="{StaticResource BodyTextBlockStyle}"
                                   TextWrapping="NoWrap" />
                    </StackPanel>
                </StackPanel>
            </DataTemplate>

        </ScrollViewer.DataTemplates>
        <StackPanel Orientation="Vertical">

            <Grid ColumnDefinitions="Auto,*,Auto">

                <TextBlock VerticalAlignment="Center" Grid.Column="0" DockPanel.Dock="Left"
                           Theme="{StaticResource TitleTextBlockStyle}" Text="{Binding Name}" />

                <controls:CommandBar VerticalAlignment="Center" DefaultLabelPosition="Right" Grid.Column="2">
                    <controls:CommandBar.PrimaryCommands>
                        <controls:CommandBarButton Label="Add" IconSource="Add" />
                    </controls:CommandBar.PrimaryCommands>
                </controls:CommandBar>
            </Grid>

            <ItemsRepeater ItemsSource="{Binding Alerts.Value^}" Margin="0,12,0,0">
                <ItemsRepeater.Layout>
                    <StackLayout Spacing="12" Orientation="Vertical" />
                </ItemsRepeater.Layout>
                <ItemsRepeater.ItemTemplate>
                    <DataTemplate>
                        <DataTemplate.DataType>
                            <x:Type TypeName="data:WithDuration" x:TypeArguments="entities:AlertViewModel" />
                        </DataTemplate.DataType>

                        <Expander HorizontalContentAlignment="Stretch">
                            <Expander.Styles>
                                <Style Selector="Expander /template/ ToggleButton#PART_toggle">
                                    <Setter Property="Padding" Value="4" />
                                    <Setter Property="HorizontalContentAlignment" Value="Stretch" />
                                </Style>
                            </Expander.Styles>
                            <Expander.Resources>
                                <system:Int64 x:Key="Int0">0</system:Int64>
                                <system:Int64 x:Key="Int1">1</system:Int64>
                                <system:Int64 x:Key="Int2">2</system:Int64>
                            </Expander.Resources>
                            <Expander.Header>
                                <Grid HorizontalAlignment="Stretch" RowDefinitions="Auto,Auto"
                                      ColumnDefinitions="Auto,*,Auto">
                                    <!--App/Tag at the left side-->
                                    <Grid Grid.Row="0" Grid.Column="0" Height="68" VerticalAlignment="Center"
                                          Margin="0,0,0,-4">
                                        <ContentControl Content="{Binding Inner.App}" VerticalAlignment="Center"
                                                        VerticalContentAlignment="Center" />
                                        <ContentControl Content="{Binding Inner.Tag}" VerticalAlignment="Center"
                                                        VerticalContentAlignment="Center" />
                                    </Grid>

                                    <!--Durations,TriggerAction on the right side-->
                                    <StackPanel Orientation="Vertical" Spacing="4" Margin="8,4"
                                                VerticalAlignment="Bottom"
                                                Grid.Column="2" Grid.Row="0">
                                        <ContentControl Content="{Binding Inner.TriggerAction}">
                                            <ContentControl.DataTemplates>
                                                <DataTemplate DataType="dataEntities:TriggerAction">

                                                    <StackPanel Orientation="Horizontal" Spacing="4"
                                                                HorizontalAlignment="Right">
                                                        <controls:FAPathIcon Height="14" Width="14"
                                                                             Data="M349.4 44.6c5.9-13.7 1.5-29.7-10.6-38.5s-28.6-8-39.9 1.8l-256 224c-10 8.8-13.6 22.9-8.9 35.3S50.7 288 64 288H175.5L98.6 467.4c-5.9 13.7-1.5 29.7 10.6 38.5s28.6 8 39.9-1.8l256-224c10-8.8 13.6-22.9 8.9-35.3s-16.6-20.7-30-20.7H272.5L349.4 44.6z"
                                                                             IsVisible="{Binding Tag, Converter={StaticResource IsEqualConverter}, ConverterParameter={StaticResource Int0}}" />
                                                        <TextBlock Text="Kill"
                                                                   IsVisible="{Binding Tag, Converter={StaticResource IsEqualConverter}, ConverterParameter={StaticResource Int0}}" />

                                                        <controls:SymbolIcon Symbol="Message" FontSize="16"
                                                                             IsVisible="{Binding Tag, Converter={StaticResource IsEqualConverter}, ConverterParameter={StaticResource Int1}}" />
                                                        <TextBlock Text="Message"
                                                                   IsVisible="{Binding Tag, Converter={StaticResource IsEqualConverter}, ConverterParameter={StaticResource Int1}}" />

                                                        <controls:FAPathIcon Height="14" Width="14"
                                                                             Data="M2.21967 2.21967C1.9534 2.48594 1.9292 2.9026 2.14705 3.19621L2.21967 3.28033L6.25424 7.3149C4.33225 8.66437 2.89577 10.6799 2.29888 13.0644C2.1983 13.4662 2.4425 13.8735 2.84431 13.9741C3.24613 14.0746 3.6534 13.8305 3.75399 13.4286C4.28346 11.3135 5.59112 9.53947 7.33416 8.39452L9.14379 10.2043C8.43628 10.9258 8 11.9143 8 13.0046C8 15.2138 9.79086 17.0046 12 17.0046C13.0904 17.0046 14.0788 16.5683 14.8004 15.8608L20.7197 21.7803C21.0126 22.0732 21.4874 22.0732 21.7803 21.7803C22.0466 21.5141 22.0708 21.0974 21.8529 20.8038L21.7803 20.7197L15.6668 14.6055L15.668 14.604L14.4679 13.4061L11.598 10.5368L11.6 10.536L8.71877 7.65782L8.72 7.656L7.58672 6.52549L3.28033 2.21967C2.98744 1.92678 2.51256 1.92678 2.21967 2.21967ZM10.2041 11.2655L13.7392 14.8006C13.2892 15.2364 12.6759 15.5046 12 15.5046C10.6193 15.5046 9.5 14.3853 9.5 13.0046C9.5 12.3287 9.76824 11.7154 10.2041 11.2655ZM12 5.5C10.9997 5.5 10.0291 5.64807 9.11109 5.925L10.3481 7.16119C10.8839 7.05532 11.4364 7 12 7C15.9231 7 19.3099 9.68026 20.2471 13.4332C20.3475 13.835 20.7546 14.0794 21.1565 13.9791C21.5584 13.8787 21.8028 13.4716 21.7024 13.0697C20.5994 8.65272 16.6155 5.5 12 5.5ZM12.1947 9.00928L15.996 12.81C15.8942 10.7531 14.2472 9.10764 12.1947 9.00928Z"
                                                                             IsVisible="{Binding Tag, Converter={StaticResource IsEqualConverter}, ConverterParameter={StaticResource Int2}}" />
                                                        <TextBlock Text="Dim"
                                                                   IsVisible="{Binding Tag, Converter={StaticResource IsEqualConverter}, ConverterParameter={StaticResource Int2}}" />
                                                    </StackPanel>

                                                </DataTemplate>
                                            </ContentControl.DataTemplates>
                                        </ContentControl>

                                        <StackPanel Orientation="Horizontal" Spacing="4" HorizontalAlignment="Right">
                                            <TextBlock
                                                Text="{Binding Duration, Converter={StaticResource HumanizeTimeSpanConverter}}" />
                                            <TextBlock Text="/" />
                                            <TextBlock
                                                Text="{Binding Inner.UsageLimit, Converter={StaticResource HumanizeTimeSpanConverter}, StringFormat={}{0}\,}" />
                                            <!-- TODO: show icons here -->
                                            <TextBlock Text="{Binding Inner.TimeFrame}"
                                                       Theme="{StaticResource BodyStrongTextBlockStyle}" />
                                        </StackPanel>
                                    </StackPanel>

                                    <!-- TODO: add reminder stops at some time -->
                                    <ProgressBar Height="8" Margin="4,4,4,8" Grid.Column="0" Grid.ColumnSpan="3"
                                                 Grid.Row="1"
                                                 Maximum="{Binding Inner.UsageLimit.Ticks}"
                                                 Value="{Binding Duration.Ticks}" />
                                </Grid>
                            </Expander.Header>

                            <!-- TODO Some sort of visualization of target usage? -->
                        </Expander>
                    </DataTemplate>
                </ItemsRepeater.ItemTemplate>
            </ItemsRepeater>

        </StackPanel>
    </ScrollViewer>
</reactiveUi:ReactiveUserControl>